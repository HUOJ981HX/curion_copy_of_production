!function(t,e){e=t.StoreCreditCart=function(e){function r(e){if(!(e.total_price<=0)){e=a(e);var r=t.getLocalStorage("lastLoadedCart");if(t.compareObject(r,e))return o(t.getLocalStorage("lastLoadedSpentRules"),!0),!0;t.setLocalStorage("lastLoadedCart",e);var i=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.get_spent_rules_route;t.ajax({url:i,method:"POST",data:{customer_hash:t.customerHash,token:t.token,cart:btoa(unescape(encodeURIComponent(JSON.stringify(e))))}}).done((function(t){o(t,!1)}))}}function o(e,r){if(t.setLocalStorage("lastLoadedSpentRules",e),"0"!=e.is_credit_on_cart&&!r){var o=function(e){var r=t.money_format,o=e.total_credits;if(o<=0)return"";var i=e.rules;if(i.length<=0)return"";var a=t("<div class='flits-select-row flits-cart-drp'/>"),n=t("<select class='"+t.StoreCreditCart.settings.creditDropdownClass+"' />");a.append('<div class="flits-select-arrow"><svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" fill="none" shape-rendering="geometricPrecision"><path d="M6 9l6 6 6-6"></path></svg></div>'),i.length>0&&n.append("<option value='-1'>"+t.t("Flits.locals.cart_page.select_credit_option","Select option to use store credit")+"</option>");for(var s=0;s<i.length;s++){var c=i[s].applicable_credits,d=i[s].rule.id,u="You can use {{ credit }} credit out of {{ total_credit }}.";u="cart_value"===i[s].rule.rule.column.name?(u=t.t("Flits.locals.cart_page.credit_cart_percentage","You can use {{ credit }} credit out of {{ total_credit }}.").replace("{{ credit }}",t.formatMoney(Math.abs(c),r))).replace("{{ total_credit }}",t.formatMoney(Math.abs(o),r)):(u=u.replace("{{ credit }}",t.formatMoney(Math.abs(c),r))).replace("{{ total_credit }}",t.formatMoney(Math.abs(o),r)),n.append("<option value='"+d+"'>"+u+"</option>")}return a.append(n),t(a)}(e.code);t("."+t.StoreCreditCart.settings.main_div_class).appendStoreCreditDropDown(o)}}function i(e){if(e.total_price<=0)return t.redirectToCheckout({discount:"+"}),!1;var r=t.StoreCreditCart.settings.checkoutProcessData;if(t.isEmptyObject(r)||-1==r.spentRuleId||!r.spentRuleId)return t.redirectToCheckout({discount:"+"}),!1;e=a(e);var o=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.apply_credit_route;t.ajax({url:o,method:"post",data:{customer_hash:t.customerHash,token:t.token,data:btoa(unescape(encodeURIComponent(JSON.stringify(e)))),spent_rule_id:r.spentRuleId}}).done((function(e){e.status?t.redirectToCheckout({discount:e.code}):t.redirectToCheckout({discount:"+"})})).fail((function(){t.redirectToCheckout({discount:"+"})}))}function a(e){Object.defineProperty(e,"cart_token",Object.getOwnPropertyDescriptor(e,"token")),delete e.token;for(var r=t.StoreCreditCart.settings.removeAttributesFromCart,o=0;o<e.items.length;o++)for(var i=0;i<r.length;i++)t.isNull(e.items[o][r[i]])||delete e.items[o][r[i]];return e}function n(e,r){if(function(){if(t.StoreCreditCart.settings.isProcessCheckout=!0,window.globoStores){var e=!0;if(window.globoStores.settings.storePickup.dateTimePicker.datePicker&&""==t(window.globoStores.datePicker.$node).val()&&(e=!1),window.globoStores.settings.storePickup.dateTimePicker.timePicker&&""==t(window.globoStores.timePicker.$node).val()&&(e=!1),!e)return t("#pickupDateTimeErrorMsg").show(),void(t.StoreCreditCart.settings.isProcessCheckout=!1)}if(window.Zapiet){e=!1;if(window.Zapiet.Widget.checkoutEnabled()&&(e=!0),!e)return void(t.StoreCreditCart.settings.isProcessCheckout=!1)}t.dispatchEvent("Flits:IsCheckoutPossible")}(),!t.StoreCreditCart.settings.isProcessCheckout)return!1;var o=r.closest('[data-flits="'+t.StoreCreditCart.settings.checkoutButtonParentParameterValue+'"]');if(!o)return!0;var a=t(o).find(".flits-want-to-use-credit"),n=-1;if(a.length<=0)return!0;var s=!1;switch(a.prop("tagName").toString().toLowerCase()){case"checkbox":s=a.is(":checked"),n=a.val();break;case"select":"-1"!=(n=a.val())&&(s=!0)}if(!s||-1==n)return!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var c=t(r).html(),d=t.t("Flits.locals.cart_page.applying_credit_message","Applying credit please wait");if("input"===t(r).prop("tagName").toString().toLowerCase())c=t(r).val(),t(r).val(d);else c=t(r).html(),t(r).html(d);return t(r).attr("disabled",!0),t.StoreCreditCart.settings.checkoutProcessData={btn:r,btnOldTxt:c,event:e,spentRuleId:n},t.getCart().done(i).fail((function(){return t.redirectToCheckout({discount:"+"}),!1})),!1}function s(e,r){var o;return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),n(e,r)&&(t.StoreCreditCart.settings.isDeleteDiscount&&(o=[t.base_url,t.customer_id].join("/")+t.StoreCreditCart.settings.delete_discounts_route,t.ajax({url:o,method:"post",data:{customer_hash:t.customerHash,token:t.token}})),t.redirectToCheckout({discount:"+"})),!1}t.StoreCreditCart.settings={};var c={get_spent_rules_route:"/get_credit",apply_credit_route:"/credit/apply_credit",delete_discounts_route:"/delete-discounts",main_div_class:"flits-credit-code-div",creditDropdownClass:"flits-want-to-use-credit flits-input",checkoutButtonSelectors:["input[name='checkout']","button[name='checkout']","[href$='checkout']"],checkoutFormSelectors:["form[action$='/cart'][method='post']"],updateCartButtonSelectors:["form[action$='/cart'] input[name='update']","form[action$='/cart'] button[name='update']"],isCodeAutomatic:!0,automaticCodeDiv:"#flits-cart-automatic-code",checkoutButtonParameterValue:"store-credit-added",checkoutButtonParentParameterValue:"store-credit-parent",automaticAppendDivFunction:function(){},isAjaxCart:!0,isApplyCreditChecked:!1,isProcessCheckout:!0,isDeleteDiscount:!0,removeAttributesFromCart:["sku","featured_image","product_description","title","url","handle","product_type","product_title","discounts","variant_options","options_with_values","variant_title"]};c=t.extend(t.StoreCreditCart.settings,c,e),t.dispatchEvent("Flits:StoreCreditCart:Loaded",{settings:c}),t.checkAndSetupStoreCreditDiv(),t.setLocalStorage("lastLoadedCart",{}),t.setLocalStorage("lastLoadedSpentRules",{}),t.getCart().done(r),function(){if(t(document).on("click",'[data-flits="'+t.StoreCreditCart.settings.checkoutButtonParameterValue+'"]',(function(e){return s.apply(t.StoreCreditCart,[e,this])})),t(document).on("click",t.StoreCreditCart.settings.updateCartButtonSelectors.join(","),(function(e){t(this).attr("data-flits","update-cart-btn")})),t(document).on("click",(function(e){var r=e.target,o=!1;t.each(t(t.StoreCreditCart.settings.updateCartButtonSelectors.join(",")),(function(e,i){return t(r).is(t(this))?(o=!0,!1):void 0})),o||t("[data-flits='update-cart-btn']").removeAttr("data-flits")})),t(document).on("submit",t.StoreCreditCart.settings.checkoutFormSelectors.join(","),(function(e,r){if(!t.isNull(r)&&r.flitsFormSubmitted)return!0;if(t(this).find("[data-flits='update-cart-btn']").length>0)return!0;var o=null;return e.originalEvent&&e.originalEvent.submitter&&(o=e.originalEvent.submitter),!o&&"submit"==document.activeElement.type&&(o=document.activeElement),o||(o=t(this).find("[type='submit'][data-flits='"+t.StoreCreditCart.settings.checkoutButtonParameterValue+"']")),!o||s.apply(t.StoreCreditCart,[e,o])})),t.StoreCreditCart.settings.isAjaxCart){t.addToCartAjaxEvent(),t.updateCartAjaxEvent(),t.clearCartAjaxEvent(),t.getCartAjaxEvent();var e=t.debounce((function(e){t.checkAndSetupStoreCreditDiv(),t.getCart().done(r)}),2500);t(document).on("Flits:AjaxCart:ProductAdded",e),t(document).on("Flits:AjaxCart:CartUpdated",e),t(document).on("Flits:AjaxCart:CartRendered",e),t.dispatchEvent("Flits:AjaxCart:Setup",{debouncedFunction:e})}}()},t.extend({checkAndSetupStoreCreditDiv:function(){t.StoreCreditCart.settings.isCodeAutomatic?t(t.StoreCreditCart.settings.checkoutButtonSelectors.join(",")).appendStoreCreditDiv():(t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).show(),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").attr("data-flits-manual-code",!0),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).parent().find(t.StoreCreditCart.settings.checkoutButtonSelectors.join(",")).attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParameterValue),t("."+t.StoreCreditCart.settings.main_div_class).not(".flits-template").parents(t.StoreCreditCart.settings.automaticCodeDiv).parent().attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParentParameterValue))}}),t.fn.extend({appendStoreCreditDropDown:function(e){return this.each((function(r,o){t(o).html(""),t(o).append(t(e).clone(!0))})),this},appendStoreCreditDiv:function(){t.StoreCreditCart.settings;return this.filter(':not([data-flits="'+t.StoreCreditCart.settings.checkoutButtonParameterValue+'"])').each((function(e,r){if("none"!=(r=t(r)).css("display")&&"hidden"!=r.css("visibility")){if("function"!=typeof r[0].addEventListener)return;var o=t(t.StoreCreditCart.settings.automaticCodeDiv).find("."+t.StoreCreditCart.settings.main_div_class).clone(!0);t(o).removeClass("flits-template");var i=r.parent();r.before(o),r.attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParameterValue),i.attr("data-flits",t.StoreCreditCart.settings.checkoutButtonParentParameterValue),t.StoreCreditCart.settings.automaticAppendDivFunction.apply(this,[r,i,o]),t.dispatchEvent("Flits:CartAutomaticCode:Loaded",{el:r,parent:i,cloneNode:o})}})),this}}),e(window.flitsObjects.StoreCreditCartPage)}(Flits);