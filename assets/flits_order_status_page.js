!function(e){e.orderStatusPage=function(){e.orderStatusPage.settings={};var t={orderDate:Shopify.checkout.updated_at,storeCredit:{referenceElement:e(".section__content .content-box:eq(0)"),sectionElement:e("#shopify-section-flits_order_status_page .flits-store-credit-box"),responseData:null,noOfTimesRecall:1,noMoreRecallAfter:6,recallDelay:12e3,totalEarnedCreditOnOrderText:e.t("Flits.locals.order_status_page.total_earned_credit_on_order","Congratulations! You have earned {{ credit }} credit on this purchase."),currentCreditBalanceText:e.t("Flits.locals.order_status_page.total_credit_balance","Your total credit balance is {{ credit }}."),shopMoreToEarnCreditText:e.t("Flits.locals.order_status_page.shop_more_to_earn_credit_html","Want to earn more credits and save big bucks? Then dive into our collection and shop more!"),shopMoreToSpentCreditText:e.t("Flits.locals.order_status_page.shop_more_to_spent_credit_html","Still have credits left? Shop more to utilise them all.")}};t=e.extend(e.orderStatusPage.settings,t),e.scOrderStatusAjaxRecall=function(){var t=e.orderStatusPage.settings.storeCredit.responseData,r=new Date,a=e.orderStatusPage.settings.orderDate;return!!(e.timeDiffer({date1:r,date2:a,type:"hour"})<=e.orderStatusPage.settings.storeCredit.noMoreRecallAfter&&t.recall)&&(setTimeout((function(){e.orderStatusPage.settings.storeCredit.noOfTimesRecall++,e.services.settings.scOrderStatusPageService()}),e.orderStatusPage.settings.storeCredit.recallDelay),!0)},e.checkSpentRuleOff=function(){return!e.orderStatusPage.settings.storeCredit.responseData.isOrderSpentRuleOn&&(e.orderStatusPage.settings.storeCredit.sectionElement.remove(),!0)},e.checkEarningRuleOff=function(){var t=e.orderStatusPage.settings.storeCredit.sectionElement,r=e.orderStatusPage.settings.storeCredit.responseData,a=r.currentCreditBalance;if(!r.isOrderEarningRuleOn){if(a<=0)return t.remove(),!0;var s=e.orderStatusPage.settings.storeCredit.currentCreditBalanceText,n=e.orderStatusPage.settings.storeCredit.shopMoreToSpentCreditText;return a=e.formatMoney(Math.abs(a),e.money_format),t.find(".current-credit-balance").html(s.replace("{{ credit }}",a)),t.find(".shop-more-to-spent-credit").html(n),e.showCreditSection(t),!0}return!1},e.checkEarningRuleOn=function(){var t=e.orderStatusPage.settings.storeCredit.sectionElement,r=e.orderStatusPage.settings.storeCredit.responseData,a=r.currentCreditBalance;if(r.isOrderEarningRuleOn&&a<=0){var s=e.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;return t.find(".shop-more-to-earn-credit").html(s),e.showCreditSection(t),!0}return!1},e.setOrderCredit=function(){var t=e.orderStatusPage.settings.storeCredit.sectionElement,r=e.orderStatusPage.settings.storeCredit.responseData;if(r.isLastOrder&&r.earnedCreditOnOrder&&r.earnedCreditOnOrder.credit>0){var a=r.earnedCreditOnOrder.credit,s=e.formatMoney(Math.abs(a),e.money_format),n=e.orderStatusPage.settings.storeCredit.totalEarnedCreditOnOrderText;if(t.find(".total-earned-credit-on-order").html(n.replace("{{ credit }}",s)),r.earnedCreditOnOrder.creditLogs.length>1){var o=!1,i="",d=0,c="",l=e("<span/>");if(e.each(r.earnedCreditOnOrder.creditLogs,(function(r,a){var s=a.module_on;switch(s){case"order_number":var n=e.t("Flits.locals.order_status_page.earned_credit_on_"+s,"You earned {{ credit }} credit for this order."),u=e.formatMoney(Math.abs(a.credits),e.money_format);n=n.replace("{{ credit }}",u),t.find(".earned-credit-on-"+s).html(n);break;case"product_tag":i=s,o=!0,c=e.t("Flits.locals.order_status_page.earned_credit_on_"+s,"You earned {{ credit }} credit by purchasing from {{ tag }} collection."),d+=parseFloat(a.credits),a.tags&&e(a.tags).each((function(t,r){let a=e('<a href="/search?q='+r+'" target="_blank" class="flits-link">'+r+"</a>");""!=l.text()&&l.append(", "),l.append(a)}))}})),o){var u=e.formatMoney(Math.abs(d),e.money_format),g=c.replace("{{ credit }}",u).replace("{{ tag }}",l.html());t.find(".earned-credit-on-"+i).html(g),t.find(".earned-credit-ul").show()}}else t.find(".earned-credit-ul").remove()}else t.find(".earned-credit-ul").remove()},e.showCreditSection=function(t){t.find(".flits-skeleton-row").fadeOut(200,(function(){t.find(".flits-order-credit-row").children(":empty").remove(),t.find(".flits-order-credit-row").fadeIn(100,(function(){e.setCreditSectionMargin(t)}))}))},e.setCreditSectionMargin=function(t){var r=!1;t.find(".flits-order-credit-row").children(":visible").each(((t,a)=>{""==e(a).text()?e(a).css("margin-top","0px"):r||(e(a).css("margin-top","0px"),r=!0)}))},e(document).on("Flits:scOrderStatusPage:AjaxSuccessful",(function(t){var r=e.orderStatusPage.settings.storeCredit.responseData=t.detail.resp,a=e.orderStatusPage.settings.storeCredit.sectionElement;if(r.status){if(e.scOrderStatusAjaxRecall())return;if(e.checkSpentRuleOff()||e.checkEarningRuleOff()||e.checkEarningRuleOn())return;r.isOrderCancelled||e.setOrderCredit();var s=r.currentCreditBalance;if(s>0){s=e.formatMoney(Math.abs(s),e.money_format);var n=e.orderStatusPage.settings.storeCredit.currentCreditBalanceText;a.find(".current-credit-balance").html(n.replace("{{ credit }}",s))}var o=e.orderStatusPage.settings.storeCredit.shopMoreToEarnCreditText;a.find(".shop-more-to-earn-credit").html(o),e.showCreditSection(a)}else{if(2==r.errorCode&&e.scOrderStatusAjaxRecall())return;a.remove()}}));var r=e.orderStatusPage.settings.storeCredit.sectionElement;flitsObjects.global.Metafields.ORDER_STATUS_PAGE.isStoreCreditEnable?(e.orderStatusPage.settings.storeCredit.referenceElement.after(r),r.show(),e.services.settings.scOrderStatusPageService()):r.remove()};e.extend({services:function(){e.services.settings={};var t={scOrderStatusPageService:null};t=e.extend(e.services.settings,t);var r=Shopify.checkout.customer_id,a=Shopify.checkout.order_id,s=e.base_url+"/"+r+"/"+a+"/get_credit",n=e.encodeData(r);n.encodedValue&&(e.customerHash=e.partialCustomerHash+n.encodedValue),e.services.settings.scOrderStatusPageService=function(t){e.ajax({method:"GET",url:s,data:{noOfTimesRecall:e.orderStatusPage.settings.storeCredit.noOfTimesRecall,customer_hash:e.customerHash,token:e.token,customerHashKey:n.randomString,orderDate:e.orderStatusPage.settings.orderDate}}).done((function(r){e.dispatchEvent("Flits:scOrderStatusPage:AjaxSuccessful",{resp:r}),t&&t(r)})).fail((function(e){})).always((function(){}))},e.dispatchEvent("Flits:services:Loaded",{settings:t})},randomString:function(e){for(var t="abcdefghijklmnopqrstuvwxyz",r="",a=0;a<e;a++)r+=t.charAt(Math.floor(26*Math.random()));return r},encodeData:function(t){t=t.toString();for(var r=e.randomString(10),a=r.split(""),s=[],n=[],o=0;o<t.length;o++)o%2==0?n.push(t[o]):s.push(t[o]);return{encodedValue:(t=n.join("")+s.join("")).replace(/[0123456789]/g,(e=>a[e])),randomString:r}}}),flitsObjects.global.Metafields.ORDER_STATUS_PAGE&&(e.services(),e.orderStatusPage())}(Flits);