{% if cart.item_count > 0 %}
    <div class="page-section page-section--cart">
        <form action="/cart" method="post" novalidate class="cart__grid">
            {% assign has_out_of_stock_product = false %}
            {% for item in cart.items %}

                {% comment %} Check available inventory {% endcomment %}
                {% assign available_inventory      = item.variant.available %}
                {% if available_inventory != true %}
                    {% assign has_out_of_stock_product = true %}
                {% endif %}

            {% endfor %}

            <div class="cart__main">
                <div class="cart__header">
                    <h1 class="cart__title">My Cart</h1>

                    <div class="cart-subtotal__container cart-summary__item">
                        <span class="cart-info__item-count">{{ 'cart.general.subtotal' | t }} (0 item)</span>
                        <span class="cart-info__subtotal">$0</span>
                    </div>

                    <div class="button-collection button-collection--cart-page hidden">
                        <input {% if has_out_of_stock_product %}disabled{% endif %} type="submit" name="checkout" class="button button--primary button__cart-header" value="{{ 'cart.general.checkout' | t }}">
                    </div>
                </div>

                <div class="cart__message-container">
                    <div class="cart__undo-message">
                        {% comment %} Placeholder for undo message {% endcomment %}
                    </div>
                </div>

                {% for item in cart.items %}
                    {% comment %} Check available inventory {% endcomment %}
                    {% assign is_out_of_stock          = false %}
                    {% assign available_inventory      = item.variant.available %}
                    {% assign inventory_policy = item.variant.inventory_policy %}
                    {% assign inventory_management = item.variant.inventory_management  %}

                    {% if inventory_management == nil %}
                        {% assign inventory_management = 'none' %}
                    {% endif %}

                    {% if available_inventory != true %}
                        {% assign is_out_of_stock = true %}
                    {% endif %}

                    <div class="cart__row">
                        <div class="cart__item--message">
                            {% if is_out_of_stock %}
                                <p>
                                    This item is no longer available. Please <a data-undo="false" href="" data-line-item-id="{{ item.id }}" class="cart__remove cart__remove--ajax">remove this item</a> before continuing to checkout.
                                </p>
                            {% endif %}
                        </div>
                        <div class="cart__line-item">
                            <div data-label="{{ 'customer.order.product' | t }}" class="cart__item cart__item--image">
                                {% if item.image != blank %}
                                    {% unless item.product.metafields.inventory.ShappifyHidden %}
                                        <a href="{{ item.url | within: collections.all }}">
                                    {% endunless %}
                                            {{ item | img_url: '200x200' | img_tag: item.title }}
                                    {% unless item.product.metafields.inventory.ShappifyHidden %}
                                        </a>
                                    {% endunless %}
                                {% endif %}
                            </div>
                            <div class="cart__item cart__item--title">
                                {% unless item.product.metafields.inventory.ShappifyHidden %}
                                    <a href="{{ item.url }}" class="cart__product-title">
                                {% endunless %}
                                    {{ item.product.title }}
                                {% unless item.product.metafields.inventory.ShappifyHidden %}
                                    </a>
                                {% endunless %}

                                {% unless item.product.has_only_default_variant %}
                                    <p class="cart__product-varient">{{ item.variant.title }}</p>
                                    <p class="cart__product-sku">SKU: {{ item.variant.sku }}</p>
                                {% endunless %}

                                {%- assign property_size = item.properties | size -%}

                                {% if property_size > 0 %}
                                    {% for p in item.properties %}
                                        {% unless p.last == blank %}
                                            {{ p.first }}:

                                            {% if p.last contains '/uploads/' %}
                                                <a href="{{ p.last }}">{{ p.last | split: '/' | last }}</a>
                                            {% else %}
                                                {{ p.last }}
                                            {% endif %}
                                        {% endunless %}
                                    {% endfor %}
                                {% endif %}

                                {% for tag in item.product.tags %}
                                    {% if tag == 'final-sale' %}
                                        <div class="line-item__final-sale">
                                            <span>Final Sale</span>
                                            <div class="tooltip tooltip--default">
                                                <span class="tooltip__icon tooltip__icon--final-sale">{% render 'icon', name: 'tooltip', class: 'svg--baseline' %}</span>
                                                <div class="tooltip__content tooltip__content--default">This item is final sale. No returns or exchanges allowed on this item.</div>
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>

                            <div class="cart__item cart__item--price" data-label="{{ 'cart.label.price' | t }}">
                                <div class="cart__header-item ">{{ 'cart.label.price' | t }}</div>
                                {% if item.original_line_price != item.line_price %}
                                    <span class="visually-hidden">{{ 'cart.label.discounted_price' | t }}</span>
                                    {{ item.price | money }}
                                    <span class="visually-hidden">{{ 'cart.label.original_price' | t }}</span>
                                    <s>{{ item.original_price | money }}</s>
                                {% else %}
                                    <div class="product__price">
                                        {% if item.variant.compare_at_price > item.price %}
                                            <s class="price__sale">
                                                {{ item.variant.compare_at_price | money }}
                                            </s>
                                        {% endif %}
                                        <span class="price__original {% if item.variant.compare_at_price > item.price %}price__original--sale{% endif %}">{{ item.price | money }}</span>
                                    </div>
                                {% endif %}
                            </div>

                            <div class="cart__item cart__item--quantity" data-label="{{ 'cart.label.quantity' | t }}">
                                <div class="cart__header-item ">{{ 'cart.label.quantity' | t }}</div>
                                <div class="form__input-container form__input-container--cart-page">
                                    <input type="number"
                                        class="cart__quantity form__control form__input"
                                        name="updates[]"
                                        id="updates_{{ item.key }}"
                                        value="{{ item.quantity }}"
                                        data-line-item-id = "{{ item.id }}"
                                        data-handle = "{{ item.product.handle }}"
                                        data-price ="{{ item.price }}"
                                        data-compare-at-price="{{ item.variant.compare_at_price }}"
                                        data-inventory-policy="{{ inventory_policy}}"
                                        data-inventory-management="{{ inventory_management }}"
                                        min="1"
                                        aria-label="{{ 'cart.general.item_quantity' | t }}"
                                        {% if item.product.metafields.inventory.ShappifyHidden %} readonly {% endif %}
                                    >
                                    {% unless item.product.metafields.inventory.ShappifyHidden %}
                                        <div class="form__increment form__increment--up"></div>
                                        <div class="form__increment form__increment--down"></div>
                                    {% endunless %}
                                </div>
                            </div>

                            <div class="cart__item cart__item--total" data-label="{{ 'cart.label.total' | t }}">
                                <div class="cart__item--total-wrapper">
                                    <div class="cart__header-item">{{ 'cart.label.total' | t }}</div>
                                    <div class="product__price">
                                        {% if item.variant.compare_at_price > item.price %}
                                            {% assign item_compare_at_price = item.variant.compare_at_price | plus: 0 %}
                                            {% assign total_sale_price = item_compare_at_price | times: item.quantity %}
                                            <s class="price__sale product__price--total-sale">
                                                {{ total_sale_price | money }}
                                            </s>
                                        {% endif %}
                                        <span class="cart__item--total-price price__original {% if item.variant.compare_at_price > item.price %}price__original--sale{% endif %}">
                                            {{ item.line_price | money }}
                                        </span>
                                    </div>
                                </div>

                                <a href="{{routes.cart_change_url}}?line={{ forloop.index }}&amp;quantity=0"
                                   class="cart__remove cart__remove--ajax"
                                   data-line-item-id="{{ item.id }}"
                                   data-line-item-title="{{ item.title }}"
                                   data-line-item-quantity="{{ item.quantity }}"
                                   {% if is_out_of_stock %}data-undo="false"{% endif %}>
                                    {{ 'cart.general.remove' | t }}{% render 'icon', name: 'remove', class: 'svg--baseline' %}
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}

                <div class="cart__footer accordion js-accordion">
                    <div class="accordion__item js-accordion__item">
                        <div class="accordion__title">
                            <button type="button" class="accordion__button js-accordion__button" id="accordion-cart--button" aria-controls="accordion-cart--content" aria-expanded="false">
                                <span class="accordion__title-wrapper">{% render 'icon', name: 'shipping', class: 'svg--baseline' %} Shipping & return information</span>

                                <div class="accordion__icon">
                                    {% render 'icon', name: 'minus', class: 'accordion__icon--close svg--baseline' %}
                                    {% render 'icon', name: 'plus', class: 'accordion__icon--open svg--baseline' %}
                                </div>
                            </button>
                        </div>
                         <div id="accordion-cart--content" class="accordion__content  js-accordion__content" role="region" aria-labelledby="accordion-cart--button" hidden>
                            <ul class="cart__additional-info">
                                {% assign additional_info_link = settings.additional_info_link %}
                                {% if shop.metafields.iamota.minimum_cart_subtotal_for_free %}
                                    <li class="cart__info cart__info--shipping">
                                        {% render 'icon', name: 'shipping', class: 'svg--baseline' %}
                                        <p>Free standard shipping on orders over {{ shop.metafields.iamota.minimum_cart_subtotal_for_free | money }}. <a href='{% if additional_info_link != blank %}{{additional_info_link}}{% else %}/policies/shipping-policy{% endif %}' target="_blank">Details</a></p>
                                    </li>
                                {% endif %}

                                <li class="cart__info cart__info--return">
                                    {% render 'icon', name: 'return', class: 'svg--baseline' %}
                                    <p>Easily return your purchase by mail. <a href='{% if additional_info_link != blank %}{{additional_info_link}}{% else %}/policies/shipping-policy{% endif %}' target="_blank">Details</a></p>
                                </li>
                            </ul>
                        </div>

                        <div class="cart__instructions">
                            <p class="cart__instructions__heading">Special instructions for seller</p>
                            <textarea name="note">{{ cart.note }}</textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="cart__sidebar">
                <div class="cart__summary-wrapper">
                    <h2 class="cart__title">Order Summary</h2>

                    <div class="cart__summary">
                        <div class="cart-subtotal__container cart-summary__item">
                            <span class="cart-info__item-count">{{ 'cart.general.subtotal' | t }} (0 item)</span>
                            <span class="cart-info__subtotal">$0</span>
                        </div>

                        <div class="cart-taxes--container cart-summary__item">
                            <div class="cart-label cart-label--taxes">
                                Taxes
                            </div>
                            <div class='cart-price cart-price--taxes'>Calculated at checkout</div>
                        </div>

                        <div class="cart__subtotal cart-summary__item">
                            <p class="cart__subtotal-label">Estimated Total</p>
                            <p class="cart__subtotal-price">{{ cart.total_price | money }}</p>
                        </div>

                        <div class="button-collection button-collection--cart-page hidden">
                            <input {% if has_out_of_stock_product %}disabled{% endif %} type="submit" name="checkout" class="button button--primary button__cart" value="{{ 'cart.general.checkout' | t }}">
                        </div>
                        {% comment %}
                            ---- Disable additional checkout buttons on the cart page to have them in the Checkout page instead.

                            {% if additional_checkout_buttons %}
                                <div class="additional-checkout-buttons">
                                    {{ content_for_additional_checkout_buttons }}
                                </div>
                            {% endif %} 
                        {% endcomment %}
                    </div>
                </div>
            </div>
        </form>
    </div>
{% else %}

    {% comment %}
      Cart empty state
    {% endcomment %}
    <div class="page-section">
        <div class="supports-cookies">
            <p>{{ 'cart.general.empty' | t }}</p>
            <p>{{ 'cart.general.continue_browsing_html' | t }}</p>
        </div>

        {% comment %}
          Cart no cookies state
          ---------------------
          Browser cookies are required to use the cart. If cookies aren't enabled in the
          browser a message is displayed prompting the user to enable them.
        {% endcomment %}
        <div class="supports-no-cookies">
            <p>{{ 'cart.general.cookies_required' | t }}</p>
        </div>
    </div>
{% endif %}
