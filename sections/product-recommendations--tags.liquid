<section class="product-recommendations product-slider" itemscope itemtype="http://schema.org/Product" id="ProductSection-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="product" data-enable-history-state="true">
    {%- assign counter = 0 -%}
    {%- assign break_at = 8 -%}
    {%- assign current_product = product -%}

    {%- capture related_items -%}
        {% for collection in current_product.collections %}
            {% if collection.title != "All" %}
                {% for product in collection.products %}
                    {%- unless product.handle == current_product.handle -%}                    
                        {%- if product.tags contains 'recommended' -%}                    
                            <li class="swiper-slide">
                                {% render 'card--product', product: product %}
                            </li>

                            {%- assign counter = counter | plus: 1 -%}

                            {%- if counter == break_at -%}
                                {%- break -%}
                            {%- endif -%}
                        {%- endif -%}
                    {%- endunless -%}     
                {% endfor %}
            {% endif %}
        {% endfor %}
    {%- endcapture -%}

    {%- assign related_items = related_items | trim -%}
    {%- unless related_items == blank -%}
        {% if section.settings.title != blank %}
            <div class="container">
                <h2 class="product-slider__title">{{ section.settings.title | escape }}</h2>
            </div>
        {% endif %}

        <div class="carousel--product-slider-wrapper product-recommendations--tags">
            <div class=" animate-in animate-in--slide-right swiper carousel--product-slider container product-recommendations-slider">
                <ul class="swiper-wrapper">
                    {{ related_items }}
                </ul>
    
                <!-- If we need pagination -->
                <div class="swiper-pagination"></div>
            </div>  
    
             <!-- If we need navigation buttons -->
             <div class="swiper-arrow swiper-button-prev" tabindex="-1">
                <svg class='icon icon__arrow--left'><use xlink:href='#icon-swiper-previous'></use></svg>
                <span class="sr-only">Previous</span>
            </div>
            <div class="swiper-arrow swiper-button-next" tabindex="-1">
                <svg class='icon icon__arrow--right'><use xlink:href='#icon-swiper-next'></use></svg> 
                <span class="sr-only">Next</span>
            </div>
        </div>
    {%- endunless -%}
</section>

{% schema %}
{
    "name": "Product Recommendations",
    "class": "page-section page-section--product-recommendations page-section--full-bleed",
    "settings": [
        {
            "type": "text",
            "id": "title",
            "label": "Heading"
        }
    ]
}
{% endschema %}