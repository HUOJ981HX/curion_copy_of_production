{% if section.blocks.size > 0 %}
    {% if section.blocks.size > 1 %}
        <div class="content-panel--stacked-background {{ section.settings.starting_orientation }}{% if section.blocks.size > 2 %} stacked-background--fixed{%endif%}">
    {% endif %}

    {% for block in section.blocks %}
        {% if section.settings.starting_orientation == 'left' %}
            {% capture content_align %}{% cycle "left", "right" %}{% endcapture %}
        {% else %}
            {% capture content_align %}{% cycle "right", "left" %}{% endcapture %}
        {% endif %}

        <section class="content-panel content-panel--default content-panel--split align-{{ content_align }}">
            <div class="content-panel__container">
                <div class="content-panel__meta">
                    {% render 'responsive-image' with image: block.settings.content_panel_image, image_class: "background-image animate-in animate-in--content-panel" %}
                </div>

                <div class="content-panel__content ">
                    {% if block.settings.content_panel_icon_image != blank %}
                        {% render 'responsive-image' with image: block.settings.content_panel_icon_image, image_class: "content-panel__icon icon" %}
                    {% endif %}
                    
                    {%- if block.settings.copy_block_subtitle != blank -%}
                        <span class="subtitle subtitle--{{ block.settings.content_panel_subtitle_color | default: 'blue' }}">{{ block.settings.copy_block_subtitle | escape }}</span>
                    {%- endif -%}

                    {% if block.settings.copy_block_title != blank %}
                        <h2 class="copy-block__title">{{ block.settings.copy_block_title }}</h2>
                    {% endif %}

                    {% if block.settings.copy_block_text != blank %}
                        <div class="copy-block__text">{{ block.settings.copy_block_text }}</div>
                    {% endif %}

                    {% if block.settings.copy_block_button_text != blank and block.settings.copy_block_button_link != blank %}
                        <a href="{{ block.settings.copy_block_button_link }}" 
                           class="button button--primary button--text"
                           {% if section.settings.copy_block_button_link contains 'http://' or section.settings.copy_block_button_link contains 'https://' %}target="_blank"{% endif %}
                        >
                        {{ block.settings.copy_block_button_text }} <span class="button__icon-wrapper">{% render 'icon', name: 'arrow--cta-short', class: 'button__icon' %}</span>
                        </a>
                    {% endif %}

                    {% if block.settings.contact_cta_checkbox == true %}
                        {% assign modal_id = "contact_form-" | append: section.id  | default: "contact_form" %}
                        <button data-modal-target="{{modal_id}}" class="modal__trigger button button--primary">{{ block.settings.contact_cta_btn_label | default: 'Contact Us'}}</button>
                        {% render 'contact-form--modal', modal_id : modal_id %}
                    {% endif %}
                </div>
            </div>
        </section>
    {% endfor %}

    {% if section.blocks.size > 1 %}
        {%- comment -%}
            Closing <div class="content-panel--stacked-background">
        {%- endcomment -%}
        </div> 
    {% endif %}
{% endif %}

{% schema %}
{
    "name": "Content Panel",
    "class": "page-section page-section--content-panel page-section--full-bleed",
    "settings": [
        {
            "type"  : "radio",
            "id"    : "starting_orientation",
            "options": [
                { "value": "right", "label": "Image on the Left. Content on the Right"},
                { "value": "left", "label": "Image on the Right. Content on the Left"}
            ],
            "label": "Starting Orientation",
            "info" : "Panels in this section will automatically alternate between the content on the left/right side. You may select the orientation of the first panel."
        }
    ],
    "blocks": [
        {
            "type": "content-panel",
            "name": "Content Panel",
            "limit": 10,
            "settings": [
                {
                    "type"  : "image_picker",
                    "id"    : "content_panel_image",
                    "label" : "Image"
                },
                {
                    "type"  : "image_picker",
                    "id"    : "content_panel_icon_image",
                    "label" : "Icon Image"
                },
                {
                    "type"  : "text",
                    "id"    : "copy_block_subtitle",
                    "label" : "Subtitle"
                },
                {
                    "type": "radio",
                    "id": "content_panel_subtitle_color",
                    "label": "Choose the colour for the subtitle.",
                    "info" : "Default colour will be blue.",
                    "options": [
                        { "value": "blue", "label": "Blue" },
                        { "value": "coral", "label": "Coral" }
                    ]
                },
                {
                    "type"    : "text",
                    "id"      : "copy_block_title",
                    "label"   : "Title",
                    "default" : "Content Panel Title"
                },
                {
                    "type"    : "richtext",
                    "id"      : "copy_block_text",
                    "label"   : "Description",
                    "default" : "<p>Content Panel Description</p>"
                },
                {
                    "type"  : "text",
                    "id"    : "copy_block_button_text",
                    "label" : "Button Label"
                },
                {
                    "type"  : "url",
                    "id"    : "copy_block_button_link",
                    "label" : "Button Link"
                },
                {
                    "type": "checkbox",
                    "id": "contact_cta_checkbox",
                    "label": "Show Contact Form CTA",
                    "info" : "Display a contact button (contact form popup) on this content panel.",
                    "default": false
                },
                {
                    "type"    : "text",
                    "id"      : "contact_cta_btn_label",
                    "label"   : "Contact Form CTA button label",
                    "default" : "Contact Us",
                    "info"    : "Overwrite the label for the contact button. Default label is 'Contact Us'"
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "Content Panel",
            "category": "Components"
        }
    ]
}
{% endschema %}
