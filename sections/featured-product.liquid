{%- assign product = all_products[section.settings.product] -%}
{%- assign current_variant = product.selected_or_first_available_variant -%}
{%- assign featured_image = current_variant.featured_image | default: product.featured_image -%}

{% if product == empty %}
  {%- assign section_onboarding = true -%}
  {%- assign onboarding_title = 'homepage.onboarding.product_title' | t -%}
{% endif %}

<div data-section-id="{{ section.id }}" data-section-type="product" class="featured-product">
    <a href="{{ product.url }}" class="featured-product__image">
        {% if product.tags contains 'sale' %}
            <div class="card__tag card__tag--sale">Sale</div>
        {% elsif product.tags contains 'new' %}
            <div class="card__tag">New</div>
        {% endif %}

        {% render 'responsive-image' with
          image: product.featured_image,
          image_class: "background-image"
        %}
    </a>

    <div class="featured-product__content">
        {% if section.settings.display_reviews %}
            <a href="{{ product.url }}#shopify-product-reviews" class="shopify-product-reviews-badge__link">
                <span class="shopify-product-reviews-badge" data-id="{{ product.id }}"></span>
            </a>
        {% endif %}

        <a href="{{ product.url }}" class="featured-product__title-link">
            <h2 class="featured-product__title">{{ product.title | default: onboarding_title }}</h2>
        </a>

        {% if section.settings.display_price %}
            <div class="price__wrapper">
                <div class="product__price">
                    {% if product.compare_at_price_max > product.price %}
                        <span class="visually-hidden">{{ 'products.product.regular_price' | t }}</span>
                        <s class="price__sale">
                            {% if current_variant.compare_at_price > current_variant.price %}
                                {{ current_variant.compare_at_price | money }}
                            {% endif %}
                        </s>
                    {% endif %}

                    <span class="price__original {% if current_variant.compare_at_price > current_variant.price %}price__original--sale{% endif %}">
                        {{ current_variant.price | money }}
                    </span>
                </div>

                {% if product.tags contains 'Final-Sale' %}
                    <div class="line-item__final-sale">
                        <span>Final Sale</span>
                        <div class="tooltip tooltip--default">
                            <span class="tooltip__icon tooltip__icon--final-sale">
                                {% render 'icon', name: 'tooltip', class: 'svg--baseline' %}
                            </span>
                            <div class="tooltip__content">This item is final sale. No returns or exchanges allowed on this item.</div>
                        </div>
                    </div>
                {% endif %}
            </div>
        {% endif %}

        <div class="rte featured-product__description">
            {{ product.description }}
        </div>

        <a href="{{product.url}}" class="button button--primary button__featured-product">Shop Now</a>
    </div>

    {% unless product == empty %}
        <script type="application/json" data-product-json>
            {{ product | json }}
        </script>
    {% endunless %}
</div>

{% schema %}
{
    "name": "Featured product",
    "class": "page-section page-section--featured-product",
    "settings": [
        {
            "type": "product",
            "id": "product",
            "label": "Product"
        },
        {
            "type": "checkbox",
            "id": "display_price",
            "label": "Show Price"
        },
        {
            "type": "checkbox",
            "id": "display_reviews",
            "label": "Show Review Stars"
        }
    ]
}
{% endschema %}

<script type="application/ld+json">
{
    "@context": "http://schema.org/",
    "@type": "Product",
    "name": "{{ product.title | escape }}",
    "url": "{{ shop.url }}{{ product.url }}",
    {% if product.featured_image %}
        {% assign image_size = product.featured_image.width | append: 'x' %}
        "image": [
            "https:{{ product.featured_image.src | img_url: image_size }}"
        ],
    {% endif %}
    "description": "{{ product.description | strip_html | escape }}",
    {% if current_variant.sku != blank %}
        "sku": "{{ current_variant.sku }}",
    {% endif %}
    "brand": {
        "@type": "Thing",
        "name": "{{ product.vendor | escape }}"
    },
    {% if product.variants %}
        "offers": [
            {% for variant in product.variants %}
                {
                    "@type" : "Offer",
                    "availability" : "http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}",
                    "price" : "{{ variant.price | divided_by: 100.00 }}",
                    "priceCurrency" : "{{ shop.currency }}",
                    "url" : "{{ shop.url }}{{ variant.url }}",
                    "itemOffered" :
                    {
                        "@type" : "Product",
                        {% if variant.image %}
                            {% assign variant_image_size = variant.image.width | append: 'x' %}
                            "image": "http:{{ variant.image.src | img_url: variant_image_size }}",
                        {% endif %}
                        {% if variant.title != blank %}
                            "name" : "{{ variant.title | escape }}",
                        {% endif %}
                        {% if variant.sku != blank %}
                            "sku": "{{ variant.sku }}",
                        {% endif %}
                        {% if variant.weight != blank %}
                            "weight": {
                                "@type": "QuantitativeValue",
                                {% if variant.weight_unit != blank %}
                                    "unitCode": "{{ variant.weight_unit }}",
                                {% endif %}
                                "value": "{{ variant.weight | weight_with_unit: variant.weight_unit }}"
                            },
                        {% endif %}
                        "url": "{{ shop.url }}{{ variant.url }}"
                    }
                }{% unless forloop.last %},{% endunless %}
            {% endfor %}
        ]
    {% endif %}
}
</script>
